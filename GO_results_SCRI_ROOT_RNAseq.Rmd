---
title: "GO_results_SCRI_ROOT_RNAseq"
author: "Houston Saxe"
date: "1/24/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
pacman::p_load(dplyr, tibble, readr, stringr, data.table, ggplot2, cowplot, tidyr)
```


```{r}
dat = as.data.frame(read_tsv("C:/Users/hsaxe/Downloads/analysis (21).txt", skip = 11))

colnames(dat) = str_extract(colnames(dat), 'biological process|cellular component|(?<=\\().*?(?=\\))')

# `cellular component`
# biological process

dat = dat %>%
  mutate(GO_term = str_extract(`biological process`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

head(dat)

# fwrite(dat, 'test_GO_BP_Jr_parsed_CG.csv')
```

# GO biological process plotting CG
```{r}
dat = fread('GO_BP_parsed_CG.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`biological process`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat %>%
  filter(`biological process` %like% 'wall|poly|glucan|cellulose|ATP|RNA') 

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `biological process`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('Crown Gall GO Biological Process Results (', length(unique(dat$`biological process`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_BP_CG_plot.png', p)
```

# GO cellular component plotting CG
```{r}
dat = fread('GO_CC_parsed_CG.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`cellular component`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat %>%
  filter(log2FC^2 >=1, FDR <= 0.01)

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `cellular component`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('Crown Gall GO Cellular Component Results (', length(unique(dat$`cellular component`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_CC_CG_plot.png', p)
```


# GO biological process plotting PHY
```{r}
dat = fread('GO_BP_parsed_PHY.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`biological process`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat %>%
  filter(`biological process` %like% 'wall|poly|glucan|cellulose|ATP|RNA')
   # filter(log2FC^2 >=4, FDR <= 0.01)

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `biological process`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('P. Cinn GO Biological Process Results (', length(unique(dat$`biological process`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_BP_PHY_plot.png', p)
```


# GO cellular component plotting PHY
```{r}
dat = fread('GO_CC_parsed_PHY.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`cellular component`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat 
  # filter(log2FC^2 >=1, FDR <= 0.01)

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `cellular component`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('P. Cinn GO Cellular Component Results (', length(unique(dat$`cellular component`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_CC_PHY_plot.png', p)
```


# GO biological process plotting NEM
```{r}
dat = fread('GO_BP_parsed_NEM.csv')

labs = dat %>%
  filter(`biological process` %like% 'wall|poly|glucan|cellulose|ATP|RNA')
   # filter(log2FC^2 >=4, FDR <= 0.01)

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `biological process`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('Nematode GO Biological Process Results (', length(unique(dat$`biological process`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_BP_NEM_plot.png', p)
```


# GO cellular component plotting NEM
```{r}
dat = fread('GO_CC_parsed_NEM.csv')

labs = dat 
  # filter(log2FC^2 >=1, FDR <= 0.01)

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `cellular component`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('Nematode GO Cellular Component Results (', length(unique(dat$`cellular component`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('GO_CC_NEM_plot.png', p)
```


# Test GO biological process plotting CG Jr
```{r}
dat = fread('test_GO_BP_Jr_parsed_CG.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`biological process`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat %>%
  filter(`biological process` %like% 'wall|poly|glucan|cellulose|ATP|RNA') 

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `biological process`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('test Jr Crown Gall GO Biological Process Results (', length(unique(dat$`biological process`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('test_GO_BP_Jr_CG_plot.png', p)
```


# Test GO biological process plotting CG Jm
```{r}
dat = fread('test_GO_BP_Jm_parsed_CG.csv')

dat = dat %>%
  mutate(GO_term = str_extract(`biological process`, '(?<=:).*?(?=\\))'), `fold Enrichment` = gsub('< 0.01', '0.01', `fold Enrichment`)) %>%
  mutate(GO_term = as.numeric(GO_term), log2FC = log2(as.numeric(`fold Enrichment`)))

labs = dat %>%
  filter(`biological process` %like% 'wall|poly|glucan|cellulose|ATP|RNA') 

p = ggplot(dat, aes(FDR, log2FC))+
  geom_point(aes(size = log2FC^2, color = log2FC))+
  geom_point(aes(size = log2FC^2), shape = 1, color = 'black')+
  # geom_text(aes(label = `GO biological process complete`), angle = 45)+
  theme(legend.position = 'none')+
  guides(color = 'none', size = 'none', fill = 'none')+
  scale_x_log10()+
  coord_cartesian(clip = "off") +
  # geom_text(data = labs, aes(label = `biological process`), angle = 45)+
  ggrepel::geom_label_repel(data = labs, aes(label = `biological process`), size = 1, box.padding = 0.4, max.overlaps = 30)+
  ggtitle(paste0('test Jm Crown Gall GO Biological Process Results (', length(unique(dat$`biological process`)), ' terms)'))+
  scale_color_gradient(low = 'blue', high = 'red')

p

save_plot('test_GO_BP_Jm_CG_plot.png', p)
```